<!DOCTYPE html>
<html>
<head>
    <title>n8n Webhook Tester with Graph Preview</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            padding: 2rem;
            background: #f4f6f8;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
        }
        h2 { margin-top: 0; }
        label { 
            font-weight: bold; 
            display: block; 
            margin-top: 1rem; 
            margin-bottom: 0.5rem; 
        }
        textarea, input {
            width: 100%;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box; /* Ensures padding doesn't overflow width */
            font-family: monospace;
        }
        button {
            margin-top: 20px;
            padding: 12px 24px;
            font-size: 16px;
            background: #ff6d5a; /* n8n orange-red */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.2s;
        }
        button:hover {
            background: #e65a48;
        }
        #responseBox {
            margin-top: 20px;
            white-space: pre-wrap;
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            min-height: 50px;
            font-family: monospace;
            overflow-x: auto;
        }
        #graphImage {
            margin-top: 20px;
            max-width: 100%;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: none; /* Hidden by default */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>

<h2>Test n8n Medical Agent Webhook</h2>

<label>Webhook URL:</label>
<input id="webhookUrl" placeholder="https://your-n8n-instance.com/webhook/..." value="">

<label>JSON Body:</label>
<textarea id="jsonBody" rows="10">
{
  "patient_name": "Sarah Jenkins",
  "patient_id": "P001",
  "current_symptoms": "fever, cough",
  "patient_history": [
    { "visit_date": "2025-01-01", "severity_score": 8 },
    { "visit_date": "2025-01-05", "severity_score": 6 }
  ]
}
</textarea>

<button onclick="sendRequest()" id="submitBtn">Send POST Request</button>

<h3>Response:</h3>
<div id="responseBox">Waiting for response...</div>

<h3>Recovery Curve Graph:</h3>
<img id="graphImage" alt="Graph will appear here">

<script>
async function sendRequest() {
    const url = document.getElementById('webhookUrl').value;
    const body = document.getElementById('jsonBody').value;
    const responseBox = document.getElementById("responseBox");
    const imgObj = document.getElementById("graphImage");
    const btn = document.getElementById("submitBtn");

    if(!url) {
        alert("Please enter a Webhook URL");
        return;
    }

    // UI Updates
    responseBox.innerText = "Sending request...";
    imgObj.style.display = "none";
    btn.disabled = true;
    btn.innerText = "Processing...";

    try {
        const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: body
        });

        const json = await response.json();
        
        // 1. Show the raw JSON text
        responseBox.innerText = JSON.stringify(json, null, 2);

        // 2. LOGIC FIX: Handle Base64 Image
        // We look for 'image_data' (from your n8n Code Node)
        if (json.image_data) {
            
            // Default to png if n8n didn't send a file_type
            const mimeType = json.file_type || "image/png";
            
            // Construct the Data URI: "data:image/png;base64,...."
            imgObj.src = `data:${mimeType};base64,${json.image_data}`;
            
            // Make the image visible
            imgObj.style.display = "block";
        } else {
            console.log("No 'image_data' key found in response.");
        }

    } catch (error) {
        responseBox.innerText = "Error: " + error.message;
        console.error(error);
    } finally {
        btn.disabled = false;
        btn.innerText = "Send POST Request";
    }
}
</script>

</body>
</html>